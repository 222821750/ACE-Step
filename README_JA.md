<h1 align="center">ACE-Step</h1>
<h1 align="center">音楽生成基盤モデルへの一歩</h1>
<p align="center">
    <a href="https://ace-step.github.io/">プロジェクト</a> |
    <a href="https://huggingface.co/ACE-Step/ACE-Step-v1-3.5B">Hugging Face</a> |
    <a href="https://modelscope.cn/models/ACE-Step/ACE-Step-v1-3.5B">ModelScope</a> |
    <a href="https://huggingface.co/spaces/ACE-Step/ACE-Step">Spaceデモ</a> |
     <a href="https://discord.gg/PeWDxrkdj7">Discord</a>
</p>
<p align="center">
  <a href="./README.md"><img alt="README in English" src="https://img.shields.io/badge/English-d9d9d9"></a>
  <a href="./README_CN.md"><img alt="简体中文版自述文件" src="https://img.shields.io/badge/简体中文-d9d9d9"></a>
  <a href="./README_JA.md"><img alt="日本語のREADME" src="https://img.shields.io/badge/日本語-d9d9d9"></a>
</p>
---
<p align="center">
    <img src="./assets/orgnization_logos.png" width="100%" alt="StepFun ロゴ">
</p>

## 目次

- [✨ 特徴](#-特徴)
- [📦 インストール](#-インストール)
- [🚀 使い方](#-使い方)
- [📱 ユーザーインターフェースガイド](#-ユーザーインターフェースガイド)
- [🔨 トレーニング](#-トレーニング)

## 📝 概要

私たちは、既存のアプローチの主要な制限を克服し、包括的なアーキテクチャ設計を通じて最先端のパフォーマンスを達成する、新しいオープンソースの音楽生成基盤モデルであるACE-Stepを紹介します。現在の方法は、生成速度、音楽的一貫性、および制御可能性の間で固有のトレードオフに直面しています。例えば、LLMベースのモデル（例：Yue、SongGen）は歌詞のアライメントに優れていますが、推論が遅く、構造的なアーティファクトに悩まされています。一方、拡散モデル（例：DiffRhythm）はより高速な合成を可能にしますが、しばしば長期的な構造的一貫性に欠けます。

ACE-Stepは、拡散ベースの生成とSanaのDeep Compression AutoEncoder (DCAE) および軽量な線形トランスフォーマーを統合することにより、このギャップを埋めます。さらに、トレーニング中にMERTとm-hubertを活用して意味表現 (REPA) を調整し、迅速な収束を可能にします。その結果、当社のモデルはA100 GPUでわずか20秒で最大4分間の音楽を合成し、LLMベースのベースラインよりも15倍高速でありながら、メロディ、ハーモニー、リズムの指標全体で優れた音楽的一貫性と歌詞のアライメントを実現します。さらに、ACE-Stepは微細な音響的詳細を保持し、音声クローニング、歌詞編集、リミックス、トラック生成（例：歌詞からボーカル、歌唱から伴奏）などの高度な制御メカニズムを可能にします。

私たちのビジョンは、さらに別のエンドツーエンドのテキストから音楽へのパイプラインを構築するのではなく、音楽AIの基盤モデルを確立することです。つまり、高速で、汎用的で、効率的かつ柔軟なアーキテクチャであり、その上にサブタスクを簡単にトレーニングできるようにすることです。これは、音楽アーティスト、プロデューサー、コンテンツクリエーターの創造的なワークフローにシームレスに統合される強力なツールの開発への道を開きます。要するに、私たちは音楽におけるStable Diffusionの瞬間を築くことを目指しています。

## 📢 ニュースと更新情報

- 🚀 **2025.05.08:** [ComfyUI_ACE-Step](https://t.co/GeRSTrIvn0) ノードが利用可能になりました！ComfyUI内でACE-Stepのパワーを探求してください。🎉
![画像](https://github.com/user-attachments/assets/0a13d90a-9086-47ee-abab-976bad20fa7c)

- 🚀 2025.05.06: オープンソースのデモコードとモデルを公開

## ✨ 特徴

<p align="center">
    <img src="./assets/application_map.png" width="100%" alt="ACE-Step フレームワーク">
</p>

### 🎯 ベースライン品質

#### 🌈 多様なスタイルとジャンル

- 🎸 短いタグ、説明的なテキスト、またはユースケースシナリオを含むさまざまな記述形式で、すべての主流音楽スタイルをサポート
- 🎷 適切な楽器編成とスタイルで、さまざまなジャンルの音楽を生成可能

#### 🌍 多言語対応

- 🗣️ 19言語をサポートし、パフォーマンスの高い上位10言語は次のとおりです。
  - 🇺🇸 英語, 🇨🇳 中国語, 🇷🇺 ロシア語, 🇪🇸 スペイン語, 🇯🇵 日本語, 🇩🇪 ドイツ語, 🇫🇷 フランス語, 🇵🇹 ポルトガル語, 🇮🇹 イタリア語, 🇰🇷 韓国語
- ⚠️ データ不均衡のため、あまり一般的でない言語はパフォーマンスが低下する可能性があります

#### 🎻 楽器スタイル

- 🎹 さまざまなジャンルやスタイルの多様な器楽生成をサポート
- 🎺 各楽器に適した音色と表現力で、リアルな楽器トラックを制作可能
- 🎼 音楽的一貫性を維持しながら、複数の楽器による複雑なアレンジを生成可能

#### 🎤 ボーカルテクニック

- 🎙️ さまざまなボーカルスタイルとテクニックを高品質でレンダリング可能
- 🗣️ さまざまな歌唱テクニックやスタイルを含む、多様なボーカル表現をサポート

### 🎛️ 制御性

#### 🔄 バリエーション生成

- ⚙️ トレーニング不要の推論時最適化技術を使用して実装
- 🌊 フローマッチングモデルが初期ノイズを生成し、次にtrigFlowのノイズ式を使用して追加のガウスノイズを追加
- 🎚️ 元の初期ノイズと新しいガウスノイズの混合比を調整して、バリエーションの度合いを制御

#### 🎨 リペインティング

- 🖌️ ターゲットオーディオ入力にノイズを追加し、ODEプロセス中にマスク制約を適用することで実装
- 🔍 入力条件が元の生成から変更された場合、残りの部分を保持しながら特定の側面のみを変更可能
- 🔀 バリエーション生成技術と組み合わせて、スタイル、歌詞、またはボーカルの局所的なバリエーションを作成可能

#### ✏️ 歌詞編集

- 💡 フロー編集技術を革新的に適用し、メロディ、ボーカル、伴奏を保持しながら局所的な歌詞変更を可能に
- 🔄 生成されたコンテンツとアップロードされたオーディオの両方で機能し、創造的な可能性を大幅に向上
- ℹ️ 現在の制限：歪みを避けるために一度に歌詞の小さなセグメントしか変更できませんが、複数の編集を順次適用可能

### 🚀 アプリケーション

#### 🎤 歌詞からボーカル (LoRA)

- 🔊 純粋なボーカルデータでファインチューニングされたLoRAに基づいており、歌詞から直接ボーカルサンプルを生成可能
- 🛠️ ボーカルデモ、ガイドトラック、作曲支援、ボーカルアレンジメントの実験など、多数の実用的なアプリケーションを提供
- ⏱️ 歌詞が歌われたときにどのように聞こえるかをすばやくテストする方法を提供し、ソングライターの反復作業を高速化

#### 📝 テキストからサンプル (LoRA)

- 🎛️ 歌詞からボーカルに似ていますが、純粋な楽器データとサンプルデータでファインチューニングされています
- 🎵 テキスト記述から概念的な音楽制作用サンプルを生成可能
- 🧰 楽器ループ、効果音、および制作用の音楽要素を迅速に作成するのに役立ちます

### 🔮 近日公開予定

#### 🎤 RapMachine

- 🔥 純粋なラップデータでファインチューニングされ、ラップ生成に特化したAIシステムを作成
- 🏆 AIラップバトルやラップによる物語表現などの機能が期待されます
- 📚 ラップは卓越した物語性と表現力を持ち、並外れた応用可能性を提供します

#### 🎛️ StemGen

- 🎚️ 個々の楽器ステムを生成するためにマルチトラックデータでトレーニングされたcontrolnet-lora
- 🎯 参照トラックと指定された楽器（または楽器参照オーディオ）を入力として取ります
- 🎹 参照トラックを補完する楽器ステムを出力します。例えば、フルートのメロディにピアノ伴奏を作成したり、リードギターにジャズドラムを追加したりします

#### 🎤 歌唱から伴奏へ

- 🔄 StemGenの逆プロセスで、単一のボーカルトラックからミックスされたマスタートラックを生成
- 🎵 ボーカルトラックと指定されたスタイルを入力として、完全なボーカル伴奏を生成
- 🎸 入力ボーカルを補完する完全な楽器バッキングを作成し、あらゆるボーカル録音にプロ並みの伴奏を簡単に追加できます

## 📋 ロードマップ

- [x] トレーニングコードのリリース 🔥
- [x] LoRAトレーニングコードのリリース 🔥
- [ ] RapMachine LoRAのリリース 🎤
- [ ] ControlNetトレーニングコードのリリース 🔥
- [ ] Singing2Accompaniment ControlNetのリリース 🎮
- [ ] 評価パフォーマンスと技術レポートのリリース 📄

## 🖥️ ハードウェアパフォーマンス

ACE-Stepをさまざまなハードウェア設定で評価し、以下のスループット結果を得ました。

| デバイス        | RTF (27ステップ) | 1分間のオーディオをレンダリングする時間 (27ステップ) | RTF (60ステップ) | 1分間のオーディオをレンダリングする時間 (60ステップ) |
| --------------- | -------------- | ------------------------------------- | -------------- | ------------------------------------- |
| NVIDIA RTX 4090 | 34.48 ×        | 1.74 秒                               | 15.63 ×        | 3.84 秒                               |
| NVIDIA A100     | 27.27 ×        | 2.20 秒                               | 12.27 ×        | 4.89 秒                               |
| NVIDIA RTX 3090 | 12.76 ×        | 4.70 秒                               | 6.48 ×         | 9.26 秒                               |
| MacBook M2 Max  | 2.27 ×         | 26.43 秒                              | 1.03 ×         | 58.25 秒                              |

ACE-Stepのパフォーマンスを測定するためにRTF (リアルタイムファクター) を使用します。値が高いほど、生成速度が速いことを示します。27.27xは、1分間の音楽を生成するのに2.2秒 (60/27.27) かかることを意味します。パフォーマンスは、バッチサイズ1、27ステップの単一GPUで測定されます。

## 📦 インストール

### 1. リポジトリをクローンする
まず、ACE-Stepリポジトリをローカルマシンにクローンし、プロジェクトディレクトリに移動します。
```bash
git clone https://github.com/ace-step/ACE-Step.git
cd ACE-Step
```

### 2. 前提条件
以下がインストールされていることを確認してください。

* `Python`: バージョン3.10以降を推奨します。[python.org](https://www.python.org/) からダウンロードできます。
* `Conda` または `venv`: 仮想環境を作成するため（Condaを推奨）。

### 3. 仮想環境のセットアップ

プロジェクトの依存関係を管理し、競合を避けるために、仮想環境を使用することを強くお勧めします。次のいずれかの方法を選択してください。

#### オプションA: Condaを使用する

1.  Python 3.10で `ace_step` という名前の**環境を作成します**。
    ```bash
    conda create -n ace_step python=3.10 -y
    ```

2.  **環境をアクティブ化します。**
    ```bash
    conda activate ace_step
    ```

#### オプションB: venvを使用する

1.  **クローンしたACE-Stepディレクトリに移動します。**

2.  **仮想環境を作成します** (一般的に `venv` という名前)。
    ```bash
    python -m venv venv
    ```

3.  **環境をアクティブ化します。**
    * **Windows (cmd.exe):**
        ```bash
        venv\Scripts\activate.bat
        ```
    * **Windows (PowerShell):**
        ```powershell
        .\venv\Scripts\Activate.ps1
        ```
        *(実行ポリシーエラーが発生した場合は、最初に `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process` を実行する必要がある場合があります)*
    * **Linux / macOS (bash/zsh):**
        ```bash
        source venv/bin/activate
        ```

### 4. 依存関係のインストール
仮想環境がアクティブ化されたら：
**a.** (Windowsのみ) WindowsでNVIDIA GPUを使用する予定の場合は、まずCUDAサポート付きのPyTorchをインストールします。

```bash
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu126
```
(CUDAのバージョンが異なる場合はcu126を調整してください。他のPyTorchのインストールオプションについては、[公式PyTorchウェブサイト](https://pytorch.org/get-started/locally/) を参照してください)。

**b.** ACE-Stepとそのコア依存関係をインストールします。
```bash
pip install -e .
```

ACE-Stepアプリケーションがインストールされました。GUIはWindows、macOS、Linuxで動作します。実行方法については、[使い方](#-使い方) のセクションを参照してください。

## 🚀 使い方

![デモインターフェース](assets/demo_interface.png)

### 🔍 基本的な使い方

```bash
acestep --port 7865
```

### ⚙️ 高度な使い方

```bash
acestep --checkpoint_path /path/to/checkpoint --port 7865 --device_id 0 --share true --bf16 true
```

macOSを使用している場合は、エラーを避けるために `--bf16 false` を使用してください。

#### 🔍 APIの使用方法
ACE-Stepをライブラリとして独自のPythonプロジェクトに統合する場合は、次のpipコマンドを使用してGitHubから直接最新バージョンをインストールできます。

**pipによる直接インストール:**

1.  **Gitがインストールされていることを確認します:** この方法では、システムにGitがインストールされ、システムのPATHでアクセス可能である必要があります。
2.  **インストールコマンドを実行します:**
    ```bash
    pip install git+https://github.com/ace-step/ACE-Step.git
    ```
    他のパッケージとの競合を避けるために、このコマンドを仮想環境内で使用することをお勧めします。

#### 🛠️ コマンドライン引数

- `--checkpoint_path`: モデルチェックポイントへのパス (デフォルト: 自動的にダウンロード)
- `--server_name`: GradioサーバーがバインドするIPアドレスまたはホスト名 (デフォルト: '127.0.0.1')。ネットワーク上の他のデバイスからアクセス可能にするには '0.0.0.0' を使用します。
- `--port`: Gradioサーバーを実行するポート (デフォルト: 7865)
- `--device_id`: 使用するGPUデバイスID (デフォルト: 0)
- `--share`: Gradio共有リンクを有効にする (デフォルト: False)
- `--bf16`: より高速な推論のためにbfloat16精度を使用する (デフォルト: True)
- `--torch_compile`: `torch.compile()` を使用してモデルを最適化し、推論を高速化する (デフォルト: False)。**Windowsではサポートされていません**

## 📱 ユーザーインターフェースガイド

ACE-Stepインターフェースには、さまざまな音楽生成および編集タスク用の複数のタブがあります。

### 📝 Text2Musicタブ

1. **📋 入力フィールド**:
   - **🏷️ タグ**: 説明的なタグ、ジャンル、またはシーンの説明をカンマで区切って入力します
   - **📜 歌詞**: [verse]、[chorus]、[bridge] などの構造タグ付きで歌詞を入力します
   - **⏱️ オーディオの長さ**: 生成されるオーディオの希望の長さを設定します (-1でランダム)

2. **⚙️ 設定**:
   - **🔧 基本設定**: 推論ステップ、ガイダンススケール、シードを調整します
   - **🔬 詳細設定**: スケジューラタイプ、CFGタイプ、ERG設定などを微調整します

3. **🚀 生成**: 「Generate」をクリックして、入力に基づいて音楽を作成します

### 🔄 Retakeタブ

- 🎲 異なるシードを使用して、わずかなバリエーションで音楽を再生成します
- 🎚️ 分散を調整して、リテイクがオリジナルとどの程度異なるかを制御します

### 🎨 Repaintingタブ

- 🖌️ 音楽の特定の部分を選択的に再生成します
- ⏱️ リペイントするセクションの開始時間と終了時間を指定します
- 🔍 ソースオーディオ（text2music出力、最後のリペイント、またはアップロード）を選択します

### ✏️ Editタブ

- 🔄 タグや歌詞を変更して既存の音楽を修正します
- 🎛️ 「only_lyrics」モード（メロディを保持）または「remix」モード（メロディを変更）を選択します
- 🎚️ 編集パラメータを調整して、オリジナルのどの程度を保持するかを制御します

### 📏 Extendタブ

- ➕ 既存の曲の最初または最後に音楽を追加します
- 📐 左と右の拡張長さを指定します
- 🔍 拡張するソースオーディオを選択します

## 📂 例

`examples/input_params` ディレクトリには、音楽生成の参照として使用できるサンプル入力パラメータが含まれています。

## 🏗️ アーキテクチャ

<p align="center">
    <img src="./assets/ACE-Step_framework.png" width="100%" alt="ACE-Step フレームワーク">
</p>

## 🔨 トレーニング

### 前提条件
1. インストールセクションで説明されているように環境を準備します。

2. LoRAモデルをトレーニングする予定の場合は、PEFTライブラリをインストールします。
   ```bash
   pip install peft
   ```

3. Huggingface形式でデータセットを準備します ([Huggingface Datasetsドキュメント](https://huggingface.co/docs/datasets/index))。データセットには次のフィールドが含まれている必要があります。
   - `keys`: 各オーディオサンプルの固有識別子
   - `filename`: オーディオファイルへのパス
   - `tags`: 説明的なタグのリスト (例: `["pop", "rock"]`)
   - `norm_lyrics`: 正規化された歌詞テキスト
   - オプションのフィールド:
     - `speaker_emb_path`: 話者埋め込みファイルへのパス (利用できない場合は空文字列を使用)
     - `recaption`: さまざまな形式の追加のタグ説明

データセットエントリの例:
```json
{
	"keys": "1ce52937-cd1d-456f-967d-0f1072fcbb58",
	"filename": "data/audio/1ce52937-cd1d-456f-967d-0f1072fcbb58.wav",
	"tags": ["ポップ", "アコースティック", "バラード", "ロマンティック", "エモーショナル"],
	"speaker_emb_path": "",
	"norm_lyrics": "愛してる、愛してる、愛してる",
	"recaption": {
		"simplified": "ポップ",
		"expanded": "ポップ, アコースティック, バラード, ロマンティック, エモーショナル",
		"descriptive": "音は柔らかく優しく、静かな夜の優しいそよ風のようです。それは心地よく、切望に満ちています。",
		"use_cases": "ロマンティックな映画のBGMや親密な瞬間に適しています。",
		"analysis": "ポップ, バラード, ピアノ, ギター, 遅いテンポ, ロマンティック, エモーショナル"
	}
}
```

### トレーニングパラメータ

#### 共通パラメータ
- `--dataset_path`: Huggingfaceデータセットへのパス (必須)
- `--checkpoint_dir`: ベースモデルのチェックポイントを含むディレクトリ
- `--learning_rate`: トレーニングの学習率 (デフォルト: 1e-4)
- `--max_steps`: トレーニングの最大ステップ数 (デフォルト: 2000000)
- `--precision`: トレーニング精度、例: "bf16-mixed" (デフォルト) または "fp32"
- `--devices`: 使用するGPUの数 (デフォルト: 1)
- `--num_nodes`: 使用する計算ノードの数 (デフォルト: 1)
- `--accumulate_grad_batches`: 勾配累積ステップ (デフォルト: 1)
- `--num_workers`: データローディングワーカーの数 (デフォルト: 8)
- `--every_n_train_steps`: チェックポイント保存頻度 (デフォルト: 2000)
- `--every_plot_step`: 評価サンプルの生成頻度 (デフォルト: 2000)
- `--exp_name`: ロギング用の実験名 (デフォルト: "text2music_train_test")
- `--logger_dir`: ログ保存用ディレクトリ (デフォルト: "./exps/logs/")

#### ベースモデルのトレーニング
次でベースモデルをトレーニングします:
```bash
python trainer.py --dataset_path "path/to/your/dataset" --checkpoint_dir "path/to/base/checkpoint" --exp_name "your_experiment_name"
```

#### LoRAトレーニング
LoRAトレーニングには、LoRA設定ファイルを提供する必要があります:
```bash
python trainer.py --dataset_path "path/to/your/dataset" --checkpoint_dir "path/to/base/checkpoint" --lora_config_path "path/to/lora_config.json" --exp_name "your_lora_experiment"
```

LoRA設定ファイルの例 (lora_config.json):
```json
{
	"r": 16,
	"lora_alpha": 32,
	"target_modules": [
		"speaker_embedder",
		"linear_q",
		"linear_k",
		"linear_v",
		"to_q",
		"to_k",
		"to_v",
		"to_out.0"
	]
}
```

### 高度なトレーニングオプション
- `--shift`: フローマッチングシフトパラメータ (デフォルト: 3.0)
- `--gradient_clip_val`: 勾配クリッピング値 (デフォルト: 0.5)
- `--gradient_clip_algorithm`: 勾配クリッピングアルゴリズム (デフォルト: "norm")
- `--reload_dataloaders_every_n_epochs`: データローダーをリロードする頻度 (デフォルト: 1)
- `--val_check_interval`: 検証チェック間隔 (デフォルト: None)

## 📜 ライセンスと免責事項

本プロジェクトは [Apache License 2.0](./LICENSE) の下でライセンスされています。

ACE-Stepは、創造的な制作、教育、エンターテイメントにおける応用を伴い、多様なジャンルにわたるオリジナル音楽の生成を可能にします。肯定的かつ芸術的なユースケースをサポートするように設計されていますが、スタイルの類似性による意図しない著作権侵害、文化要素の不適切な混合、有害コンテンツ生成のための誤用などの潜在的なリスクを認識しています。責任ある使用を確実にするために、生成された作品の独創性を検証し、AIの関与を明確に開示し、保護されたスタイルや素材を改作する際には適切な許可を得ることをユーザーに奨励します。ACE-Stepを使用することにより、これらの原則を支持し、芸術的完全性、文化的多様性、および法的コンプライアンスを尊重することに同意するものとします。著者らは、著作権侵害、文化的無神経さ、または有害コンテンツの生成を含むがこれらに限定されない、モデルのいかなる誤用についても責任を負いません。

🔔 重要なお知らせ
ACE-Stepプロジェクトの唯一の公式サイトは、当社のGitHub Pagesサイトです。
他のウェブサイトは運営しておりません。
🚫 偽のドメインには、以下が含まれますが、これらに限定されません。
ac\*\*p.com, a\*\*p.org, a\*\*\*c.org
⚠️ ご注意ください。これらのサイトにアクセスしたり、信頼したり、支払いをしたりしないでください。

## 🙏 謝辞

本プロジェクトはACE StudioとStepFunが共同で主導しています。

## 📖 引用

本プロジェクトがあなたの研究に役立つ場合は、以下の引用をご検討ください：

```BibTeX
@misc{gong2025acestep,
	title={ACE-Step: A Step Towards Music Generation Foundation Model},
	author={Junmin Gong, Wenxiao Zhao, Sen Wang, Shengyuan Xu, Jing Guo},
	howpublished={\url{https://github.com/ace-step/ACE-Step}},
	year={2025},
	note={GitHubリポジトリ}
}
```